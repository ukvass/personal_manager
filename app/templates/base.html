<!-- >>> PATCH: app/templates/base.html
# Что изменил:
# - В топбаре теперь показываем email из user.email (или user_email как запасной вариант).
# - Остальной стиль не трогал.
-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Personal Manager{% endblock %}</title>
    <script src="https://unpkg.com/htmx.org@1.9.12" crossorigin="anonymous"></script>
    <style>
      :root{
        --bg:#0b1220; --panel:#121a2a; --panel-2:#0e1626;
        --text:#e6edf3; --muted:#94a3b8; --line:#1f2a3d;
        --brand:#3b82f6; --brand-700:#1d4ed8;
        --success:#22c55e; --danger:#ef4444;
        --radius:14px; --radius-sm:10px; --shadow:0 12px 32px rgba(0,0,0,.35);
      }
      html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,sans-serif;line-height:1.45}
      .topbar{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(11,18,32,.95), rgba(11,18,32,.75));border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(6px)}
      .topbar-inner{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between}
      .brand{font-weight:800;font-size:28px;letter-spacing:.3px}
      .top-actions{display:flex;align-items:center;gap:12px;color:var(--muted)}
      .pill{background:#1f2937;border:1px solid var(--line);color:var(--text);padding:8px 12px;border-radius:999px;cursor:pointer}
      .pill:hover{filter:brightness(1.05)}
      .container{max-width:1100px;margin:18px auto;padding:0 18px}
      .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:18px;margin:18px 0;box-shadow:var(--shadow)}
      h1,h2{margin:0 0 14px}
      .muted{color:var(--muted)}
      label{font-size:.95rem;color:var(--muted)}
      input,select,button{background:var(--panel-2);color:var(--text);border:1px solid var(--line);border-radius:var(--radius-sm);padding:10px 12px}
      .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
      .grid label{display:flex;flex-direction:column;gap:6px}
      .grid .actions{display:flex;align-items:flex-end}
      .btn{background:#273244;border:1px solid var(--line);cursor:pointer;padding:8px 10px}
      .btn:hover{filter:brightness(1.06)}
      .btn-primary{background:var(--brand);border-color:var(--brand-700)}
      .btn-danger{background:var(--danger);border-color:#dc2626}
      .btn-success{background:var(--success);border-color:#16a34a}
      .table{display:flex;flex-direction:column;gap:8px}
      .row{display:grid;grid-template-columns:24px 60px minmax(0,1fr) 200px 84px 104px;align-items:center;gap:8px;padding:4px 0}
      .row.header{color:var(--muted);font-weight:600;border-bottom:1px dashed var(--line);padding-bottom:8px}
      .row > *{min-width:0}
      .row-actions{display:flex;gap:8px;justify-content:flex-start}
      .status-cell,.priority-cell,.title-cell{display:flex;align-items:center;gap:.5rem}
      .status-emoji{font-size:1.1rem;line-height:1}
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">Personal Manager</div>
        <div class="top-actions">
          {% if user or user_email %}
            <span class="muted">{{ (user and user.email) or user_email }}</span>
          {% endif %}
          {% if request and request.cookies.get('access_token') %}
            <form method="post" action="/logout" class="inline">
              <button class="pill" type="submit">Logout</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>

    <main class="container">
      {% block content %}{% endblock %}
    </main>
  </body>
</html>
